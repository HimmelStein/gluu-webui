{% extends 'interface.html' %}
{% block entity_status %}
    <!-- show the flash messages first -->
    {% for message in get_flashed_messages(with_categories=True) %}
    <div class="alert alert-{{message[0]}}" role="alert">
        {{message[1]}}
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
        </button>
    </div>
    {% endfor %}
    {% if not data|length %}
        <div class="alert alert-warning" role="alert">
            <p>There are no {{entity}}s defined in the server. Kindly add a {{entity}}.</p>
        </div>
    {% endif %}
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>#</th>
                <th>{{entity}} Details</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for object in data %}
            <tr>
                <td>{{ data.index(object) }}</td>
                <td>
                    {% for key in object.keys()|sort %}
                    <p><strong>{{ key }}: </strong>{{ object[key] }}</p>
                    {% endfor %}
                </td>
                <td>
                    <form action="/{{entity|lower}}" method="post">
                        <input type="hidden" name="deleteEntity" value="{{ object['id'] }}">
                        <button type="submit" class="btn btn-sm btn-danger">Remove</button>
                    </form>

                    {# Only the provider and the License Cred enity now have PUT requests #}
                    {% if entity == "Provider" or entity == "License_Credential"%}
                    <a class="btn btn-sm btn-primary edit" href="#" data="{{object['id']}}">Edit</button>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    
    <script>
        $('.edit').click(function(){
                console.log("hey I was clicked ok!");
            $('#actionTab a:last').tab('show');
            $('#actionTab a:last').text("Edit {{entity}}");
            $("form").attr("action", "/edit/{{entity|lower}}/"+$(this).attr('data') );
            $("form button.btn-primary").text( "Update {{entity}}");
        });
    </script>
{% endblock entity_status %}
